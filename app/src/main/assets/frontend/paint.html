<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paint</title>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #141E30, #243B55);
        display: flex;
        flex-direction: column;
        height: 100vh;
        color: white;
        overflow: hidden;
    }
    
    #canvas {
        flex: 1;
        background: white;
        cursor: crosshair;
        display: block;
    }
    
    .controls {
        display: flex;
        gap: 1vw;
        padding: 1vw;
        background: rgba(0,0,0,0.5);
        justify-content: center;
    }
    
    button {
        padding: 1vw 2vw;
        font-size: clamp(14px, 1.5vw, 18px);
        background: rgba(255,255,255,0.2);
        color: white;
        border: none;
        border-radius: 0.5vw;
        cursor: pointer;
        backdrop-filter: blur(10px);
    }
    
    button:hover {
        background: rgba(255,255,255,0.3);
    }
    
    input[type="color"] {
        width: 4vw;
        height: 4vw;
        border: none;
        border-radius: 0.5vw;
        cursor: pointer;
    }
    
    .color-palette {
        position: fixed;
        bottom: 10vh;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        gap: 1vw;
        padding: 1vw;
        background: rgba(0,0,0,0.7);
        border-radius: 1vw;
        backdrop-filter: blur(10px);
    }
    
    .color-palette.show {
        display: flex;
    }
    
    .color-option {
        width: 4vw;
        height: 4vw;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid white;
        transition: transform 0.2s;
    }
    
    .color-option:hover {
        transform: scale(1.2);
    }
</style>
</head>
<body>

<script src="config.js"></script>

<canvas id="canvas"></canvas>

<div class="color-palette" id="colorPalette">
    <div class="color-option" style="background-color: #000000" onclick="selectColor('#000000')"></div>
    <div class="color-option" style="background-color: #FF0000" onclick="selectColor('#FF0000')"></div>
    <div class="color-option" style="background-color: #00FF00" onclick="selectColor('#00FF00')"></div>
    <div class="color-option" style="background-color: #0000FF" onclick="selectColor('#0000FF')"></div>
    <div class="color-option" style="background-color: #FFFF00" onclick="selectColor('#FFFF00')"></div>
    <div class="color-option" style="background-color: #FF00FF" onclick="selectColor('#FF00FF')"></div>
    <div class="color-option" style="background-color: #00FFFF" onclick="selectColor('#00FFFF')"></div>
    <div class="color-option" style="background-color: #FFA500" onclick="selectColor('#FFA500')"></div>
    <div class="color-option" style="background-color: #800080" onclick="selectColor('#800080')"></div>
    <div class="color-option" style="background-color: #FFFFFF" onclick="selectColor('#FFFFFF')"></div>
</div>

<div class="controls">
    <button onclick="clearCanvas()"><img src="icons/new.png" style="width:2.5vw;height:2.5vw"></button>
    <button onclick="toggleColorPalette()"><img src="icons/colors.png" style="width:2.5vw;height:2.5vw"></button>
    <input type="color" id="colorPicker" value="#000000" style="display:none">
    <button onclick="saveCanvas()"><img src="icons/save.png" style="width:2.5vw;height:2.5vw"></button>
    <button onclick="goBack()"><img src="icons/back.png" style="width:2.5vw;height:2.5vw"></button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const colorPicker = document.getElementById('colorPicker');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 100;

let drawing = false;
let currentColor = '#000000';

colorPicker.addEventListener('change', (e) => {
    currentColor = e.target.value;
});

canvas.addEventListener('mousedown', (e) => {
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
});

canvas.addEventListener('mousemove', (e) => {
    if (!drawing) return;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.stroke();
});

canvas.addEventListener('mouseup', () => {
    drawing = false;
});

canvas.addEventListener('mouseleave', () => {
    drawing = false;
});

// Touch support for tablets
canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
});

canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (!drawing) return;
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.stroke();
});

canvas.addEventListener('touchend', (e) => {
    e.preventDefault();
    drawing = false;
});

function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function toggleColorPalette() {
    const palette = document.getElementById('colorPalette');
    palette.classList.toggle('show');
}

function selectColor(color) {
    currentColor = color;
    document.getElementById('colorPalette').classList.remove('show');
}

async function saveCanvas() {
    const dataURL = canvas.toDataURL('image/png');
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const filename = `paint_${timestamp}.png`;
    
    try {
        const response = await fetch(`${API_BASE_URL}/save-paint`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image: dataURL, filename: filename })
        });
        const result = await response.json();
        if (result.status === 'saved') {
            alert('Saved successfully!');
        } else {
            alert('Error saving');
        }
    } catch (e) {
        alert('Error: ' + e.message);
    }
}

function goBack() {
    window.location.href = 'main.html';
}
</script>

</body>
</html>
